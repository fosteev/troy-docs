# Troy — GeoRPG

Геолокационная RPG. Игрок ходит по реальному миру, встречает монстров на карте, сражается в реальном времени, получает лут и опыт, прокачивает персонажа.

## Платформа

- **Backend**: NestJS + Nx monorepo, PostgreSQL + PostGIS, Redis, NATS
- **Client**: Flutter (iOS/Android)
- **Realtime**: Socket.IO (WebSocket)

## Core Gameplay Loop

```
Открыл карту → Увидел моба → Подошёл физически → Начал бой →
→ Использовал скиллы → Победил → Получил XP + лут →
→ Прокачался → Экипировал шмот → Повторил
```

## Ключевые сущности

- **User** — аккаунт (email, пароль, авторизация)
- **Character** — игровой персонаж с классом, уровнем, статами. У одного User может быть несколько Character, но активный на карте — один

## Классы персонажей

На старте доступны 2 класса:

| Класс | Роль | Основные атрибуты |
|---|---|---|
| **Warrior** | Ближний бой, танк | Strength, Stamina |
| **Mage** | Магический урон, стекло | Intelligence, Agility |

Планируется: **Rogue** (Agility, крит, яды, быстрые атаки).

## Боевая система

- **Реалтайм с кулдаунами** — не пошаговая
- Между скиллами персонаж бьёт **автоатакой** (Warrior — физ. удар, Mage — магическая стрела)
- **Warrior** использует **Rage** (ярость) — накапливается в бою от автоатак и получения урона, тратится на скиллы
- **Mage** использует **Mana** — тратится на скиллы, регенерирует со временем
- **Spirit** влияет на генерацию ярости (Warrior) и регенерацию маны (Mage)
- **Agility** влияет на скорость атаки, время каста, кулдауны и крит
- Защита через **Armor** (физ. урон) и **Magic Resist** (маг. урон)
- Формула снижения урона: `reduction = defense / (defense + 100)`
- 5 атрибутов: **Strength, Intelligence, Stamina, Agility, Spirit**

## Прогрессия

- Макс. уровень: **30**
- Каждый уровень: авто-рост статов по классу + **2 свободных очка** атрибутов
- Скиллы открываются по уровням: 1(авто) → 3 → 6 → 10 → 15 → 20 → 25 (всего 6 скиллов)

## Структура репозитория

```
troy-docs/
├── README.md                                # Общая концепция проекта, навигация
│
├── game-design/                             # Игровые механики и баланс
│   ├── overview.md                          # Концепция, core loop, сущности, принципы дизайна
│   ├── classes.md                           # Классы: статы, рост, скиллы каждого класса
│   ├── stats-and-formulas.md                # Атрибуты, производные, формулы урона/защиты
│   ├── leveling.md                          # XP таблица, авто-рост, свободные очки, разблокировки
│   ├── combat.md                            # Боевая система, автоатака, каст, эффекты
│   ├── monsters.md                          # [TODO] Типы мобов, статы, поведение, зоны уровней
│   ├── loot-and-items.md                    # [TODO] Предметы, редкости, дроп-таблицы
│   └── inventory-and-equipment.md           # [TODO] Слоты экипировки, ограничения
│
├── technical/                               # Техническая архитектура
│   ├── architecture.md                      # [TODO] Сервисы, стек, схема взаимодействия
│   ├── database-schema.md                   # Схема БД, таблицы, связи, PostGIS
│   ├── api-contracts.md                     # [TODO] REST/WebSocket эндпоинты, форматы
│   ├── realtime.md                          # [TODO] WebSocket события, формат сообщений
│   └── auth.md                              # [TODO] Регистрация, JWT, верификация
│
├── client/                                  # [TODO] Flutter клиент
│   ├── screens.md                           # Экраны, навигация
│   ├── map-ui.md                            # Карта: отображение мобов, игрока
│   └── battle-ui.md                         # UI боя: панель скиллов, HP + классовый ресурс (Rage/Mana)
│
└── roadmap/                                 # [TODO] Планирование
    └── mvp.md                               # Что входит в MVP, фазы, приоритеты
```

> **Правило**: файлы с пометкой `[TODO]` ещё не созданы. При добавлении нового документа — обновить эту структуру и таблицу ниже.

## Документация

Готовые документы:

| Файл | Описание |
|---|---|
| [overview.md](game-design/overview.md) | Концепция игры, core loop, основные принципы |
| [classes.md](game-design/classes.md) | Классы персонажей, стартовые статы, рост за уровень |
| [stats-and-formulas.md](game-design/stats-and-formulas.md) | Атрибуты, производные характеристики, все формулы |
| [leveling.md](game-design/leveling.md) | Система уровней, XP, свободные очки, разблокировка скиллов |
| [combat.md](game-design/combat.md) | Боевая система, автоатака, скиллы, расчёт урона |
| [database-schema.md](technical/database-schema.md) | Схема БД: User, Character, Item, Monster, связи |

## Статус

Проект на этапе проектирования. Код будет написан на основе этих документов.
