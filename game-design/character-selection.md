# Character Selection — Выбор персонажа

## Контекст

После авторизации (логин / регистрация) пользователь попадает в flow выбора персонажа. У одного User может быть от 0 до **8 персонажей**. В зависимости от количества существующих персонажей flow отличается.

---

## Flow

### Нет персонажей (первый вход)

Если у пользователя 0 персонажей — сразу открывается **экран создания персонажа**. Пропустить его нельзя: без персонажа играть невозможно.

```
[Login / Register]
       ↓
  GET /characters → []
       ↓
  Экран создания персонажа
       ↓
  POST /characters
       ↓
  Попадает в игру с новым персонажем
```

### Есть персонажи

Если у пользователя >= 1 персонаж — открывается **экран выбора персонажа**. Пользователь может:

1. **Выбрать существующего** — тап по карточке персонажа, попадает в игру
2. **Создать нового** — кнопка "Создать персонажа", переход на экран создания

```
[Login / Register]
       ↓
  GET /characters → [char1, char2, ...]
       ↓
  Экран выбора персонажа
       ├── Тап по персонажу → Играть
       └── "Создать персонажа" → Экран создания → Играть
```

### Лимит персонажей

Максимум **8 персонажей** на аккаунт. Если лимит достигнут:
- Кнопка "Создать персонажа" скрыта или задизейблена
- При попытке создания через API — ошибка `400 MAX_CHARACTERS_REACHED`

---

## Экран выбора персонажа

Список карточек персонажей. Каждая карточка показывает:

| Поле | Описание |
|---|---|
| Имя | Имя персонажа |
| Класс | Warrior / Mage (иконка + текст) |
| Уровень | Текущий уровень |

Внизу списка — кнопка **"Создать персонажа"** (если < 8 персонажей).

---

## Экран создания персонажа

Поля:

| Поле | Тип | Валидация |
|---|---|---|
| Имя персонажа | Текстовое поле | 2–20 символов, уникальное в системе |
| Класс | Выбор из списка | Warrior, Mage |

После нажатия "Создать":
1. Отправляется `POST /characters` с `{ name, class }`
2. Сервер создаёт персонажа с базовыми атрибутами класса (см. [classes.md](./classes.md))
3. Персонаж автоматически становится активным
4. Переход в игру

---

## API

### `GET /characters`

Возвращает список персонажей текущего пользователя.

**Response** `200`:
```json
{
  "characters": [
    {
      "id": "uuid",
      "name": "Achilles",
      "class": "warrior",
      "level": 12
    }
  ]
}
```

### `POST /characters`

Создаёт нового персонажа.

**Body**:
```json
{
  "name": "Achilles",
  "class": "warrior"
}
```

**Response** `201`: созданный персонаж.

**Ошибки**:
- `400 MAX_CHARACTERS_REACHED` — уже 8 персонажей
- `400 NAME_ALREADY_TAKEN` — имя занято
- `400 INVALID_CLASS` — неизвестный класс

### `POST /characters/:id/select`

Выбирает персонажа как активного.

**Response** `200`: данные выбранного персонажа.

**Ошибки**:
- `404 CHARACTER_NOT_FOUND` — персонаж не найден или не принадлежит пользователю

---

## Сводная диаграмма

```
          ┌─────────────┐
          │  Авторизация │
          └──────┬──────┘
                 ↓
         GET /characters
                 ↓
        ┌────────┴────────┐
        │                 │
   [] пусто          [chars...]
        │                 │
        ↓                 ↓
  ┌───────────┐   ┌──────────────┐
  │  Создание │   │    Выбор     │
  │ персонажа │   │  персонажа   │
  └─────┬─────┘   └──┬───────┬──┘
        │             │       │
        │         Выбрал   Создать
        │          сущ-го   нового
        │             │       │
        │             │       ↓
        │             │  ┌───────────┐
        │             │  │  Создание │  (если < 8)
        │             │  │ персонажа │
        │             │  └─────┬─────┘
        ↓             ↓        ↓
       ┌──────────────────────────┐
       │          Игра            │
       └──────────────────────────┘
```
